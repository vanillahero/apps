<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>App Packer & Protector Pro</title>
  <style>
    body { background: #121212; color: #e0e0e0; font-family: sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; }
    .container { padding: 20px; display: flex; flex-direction: column; gap: 15px; flex-grow: 1; }
    h2 { margin: 0; color: #bb86fc; }
    #dropZone { border: 2px dashed #333; padding: 40px; text-align: center; color: #888; transition: 0.3s; cursor: pointer; }
    #dropZone.hover { border-color: #bb86fc; background: #1e1e1e; color: #bb86fc; }
    textarea { background: #1e1e1e; color: #fff; border: 1px solid #333; padding: 10px; flex-grow: 1; resize: none; font-family: monospace; outline: none; }
    .controls { display: flex; gap: 10px; align-items: center; justify-content: flex-end; }
    button { background: #bb86fc; color: #000; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; }
    button:hover { background: #9965f4; }
    button.secondary { background: #03dac6; }
  </style>
</head>
<body>

  <div class="container">
    <h2>Source Code</h2>
    <div id="dropZone">Drag and drop index.html here, or paste below</div>
    <textarea id="sourceInput" placeholder="Paste your index.html here..."></textarea>

    <div class="controls">
      <button onclick="packApp()">Pack & Protect</button>
    </div>

    <h2>Protected Output</h2>
    <textarea id="outputArea" readonly></textarea>
    <div class="controls">
      <button onclick="copyOutput()" style="flex-grow: 1;">Copy to Clipboard</button>
      <button class="secondary" onclick="downloadFile()" style="flex-grow: 1;">Download index-protected.html</button>
    </div>
  </div>

  <script>
    const dropZone = document.getElementById('dropZone');
    const sourceInput = document.getElementById('sourceInput');

    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone.classList.add('hover');
    });

    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('hover');
    });

    dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropZone.classList.remove('hover');
      const file = e.dataTransfer.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          sourceInput.value = e.target.result;
        };
        reader.readAsText(file);
      }
    });

    function packApp() {
      const source = sourceInput.value;
      if (!source) return;

      const titleMatch = source.match(/<title>(.*?)<\/title>/i);
      const originalTitle = titleMatch ? titleMatch[1] : "Protected App";

      const protectionScript = `
<script>
(function() {
  setInterval(function() { debugger; }, 100);
  document.addEventListener("contextmenu", e => e.preventDefault());
  document.addEventListener("keydown", e => {
    if (e.keyCode === 123 || (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74)) || (e.ctrlKey && e.keyCode === 85)) e.preventDefault();
  });
})();
<\/script>`;

      const combinedSource = source.replace("</head>", protectionScript + "</head>");
      const base64App = btoa(unescape(encodeURIComponent(combinedSource)));

      const finalTemplate = \`<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>\${originalTitle}</title>
</head>
<body style="margin:0;padding:0;background:#121212;overflow:hidden;">
  <div id="l" style="position:fixed;top:0;left:0;width:100%;height:100%;background:#121212;color:#bb86fc;display:flex;justify-content:center;align-items:center;z-index:999999;font-family:sans-serif;font-weight:bold;">Loading...</div>
  <script>
    (function() {
      try {
        const b = "\${base64App}";
        const d = decodeURIComponent(escape(atob(b)));
        document.open();
        document.write(d);
        document.close();
        const l = document.getElementById("l");
        if (l) l.remove();
      } catch(e) {
        document.getElementById("l").innerHTML = "Error loading app.";
      }
    })();
  <\/script>
</body>
</html>\`;

      document.getElementById('outputArea').value = finalTemplate;
    }

    function copyOutput() {
      const output = document.getElementById('outputArea');
      output.select();
      document.execCommand('copy');
    }

    function downloadFile() {
      const content = document.getElementById('outputArea').value;
      if (!content) return;
      const blob = new Blob([content], { type: 'text/html' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'index-protected.html';
      a.click();
    }
  </script>

</body>
</html>
